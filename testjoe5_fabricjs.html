<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="painter/all.js" ></script>
    <script src="painter/jquery-1.10.2.min.js"></script>
    <style>
		
    </style>
</head>
<body>
    <table>
        <tr>
            <td>                
                <span>給定模板</span><button id="saveto" type="button" >圖檔輸出</button>
                <canvas id="c" width="1024" height="768" style="color:blue;border:1px solid silver;"></canvas>                
            </td>            
            <td>
                <div id="svg_div"></div>            
            </td>
        </tr>    
    </table>	
	<div id="divcx"></div>
</body>
<script>
    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
        return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    };

    fn = getParameterByName('fn');

    var frc_canvas = new fabric.Canvas('c');
    fabric.Image.fromURL('images/butterfly.jpg', function (img) {
        frc_canvas.add(img);
        img.left = 200;
        img.setCoords();
        frc_canvas.renderAll();

        fabric.loadSVGFromURL('images/b1.svg', function (svg) {
            gg = fabric.util.groupSVGElements(svg);
            //frc_canvas.add(svg);
			frc_canvas.add(gg);
		    
            //gg.center();
            //gg.setCoords();
            frc_canvas.renderAll();
        });
    });

    $("#saveto").click(function () {
        var json = {};
        json.data = encodeURIComponent(frc_canvas.toSVG());
        $.ajax({
            type: 'POST',
            dataType: "json",
            url: 'HandlerPainter.ashx?action=svg_content_save',
            data: json,
            success: function (data) {
                if (data.id == '999')
                    alert(data.message);
                else {
                    $.get('SvgContent/test.svg', function (data) {
                        $("#svg_div").html(data);
                    });
                    //                    fabric.loadSVGFromURL('SvgContent/test.svg', function (svg) {
                    //                        shape = fabric.util.groupSVGElements(svg);
                    ////                        frc_canvas.setOverlayImage(shape.toDataURL(), function () {
                    ////                            frc_canvas.overlayImage.opacity = 0.5;
                    ////                            frc_canvas.renderAll();
                    ////                        });
                    //                    });                    
                }
            }
        });
    });

    $("#export").click(function () {
        
    });
    /*
    ctx.beginPath();
    ctx.rect(10,10,150,150);
    ctx.rect(180,10,200,200);
    ctx.closePath();
    ctx.stroke();
    ctx.clip();
    */
    /*
    fabric.Image.fromURL(img01URL, function(oImg) {
    oImg.scale(.25);
    oImg.left = 50;
    oImg.top = 100;
    canvas.add(oImg);
    canvas.renderAll();
    });

    fabric.Image.fromURL(img02URL, function(oImg) {
    oImg.scale(.25);
    oImg.left = 300;
    oImg.top = 100;
    canvas.add(oImg);
    canvas.renderAll();
    });
    */
    /*
    $("#saveto").click(function () {
    var a=document.getElementById("divcx");
    //alert(a.innerHTML);
    a.innerHTML="<canvas id='cx' width='400' height='400'></canvas>";
				
    fabric.Image.fromURL(ntv_canvas.toDataURL(1), function (img) {
				
    var frc_rlt_canvas = new fabric.Canvas('cx');
    frc_rlt_canvas.add(img);
    frc_rlt_canvas.renderAll();

    var json = {};
    json.data = frc_rlt_canvas.toDataURLWithMultiplier('png', 9);
    //json.data = ntv_canvas.toDataURL(1);
    $.ajax({
    type: 'POST',
    dataType: "json",
    url: 'HandlerPainter.ashx?action=svg_save',
    data: json,
    success: function (data) {
    if (data.id == '999')
    alert(data.message);                        
    }
    });
    });
    a.innerHTML=""
    });
		
    */    
</script>
</html>
